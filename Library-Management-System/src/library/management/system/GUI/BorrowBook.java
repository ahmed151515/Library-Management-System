/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package library.management.system.GUI;

import library.management.system.Book;
import library.management.system.Borrow;
import library.management.system.Database;

import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.sql.ResultSet;
import java.sql.SQLException;

/**
 *
 * @author Ahmed
 */
public class BorrowBook extends javax.swing.JPanel {

    /**
     * Creates new form BorrowBook
     */
    public BorrowBook() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        BookIdField = new javax.swing.JTextField();
        EndDateField = new javax.swing.JTextField();
        BorrowBookLabel = new javax.swing.JLabel();
        EnterBookIdLabel = new javax.swing.JLabel();
        EndDateLabel = new javax.swing.JLabel();
        BackButton = new javax.swing.JButton();
        SendButton = new javax.swing.JButton();

        setMaximumSize(new java.awt.Dimension(600, 600));
        setMinimumSize(new java.awt.Dimension(600, 600));
        setPreferredSize(new java.awt.Dimension(600, 600));
        addHierarchyBoundsListener(new java.awt.event.HierarchyBoundsListener() {
            public void ancestorMoved(java.awt.event.HierarchyEvent evt) {
            }
            public void ancestorResized(java.awt.event.HierarchyEvent evt) {
                formAncestorResized(evt);
            }
        });
        addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentResized(java.awt.event.ComponentEvent evt) {
                formComponentResized(evt);
            }
        });
        addInputMethodListener(new java.awt.event.InputMethodListener() {
            public void caretPositionChanged(java.awt.event.InputMethodEvent evt) {
                formCaretPositionChanged(evt);
            }
            public void inputMethodTextChanged(java.awt.event.InputMethodEvent evt) {
            }
        });
        setLayout(new java.awt.GridBagLayout());
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = 10;
        gridBagConstraints.ipadx = 300;
        gridBagConstraints.ipady = 10;
        gridBagConstraints.insets = new java.awt.Insets(20, 100, 20, 100);
        add(BookIdField, gridBagConstraints);

        EndDateField.setText("");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.gridwidth = 10;
        gridBagConstraints.ipadx = 300;
        gridBagConstraints.ipady = 10;
        gridBagConstraints.insets = new java.awt.Insets(20, 100, 20, 100);
        add(EndDateField, gridBagConstraints);

        BorrowBookLabel.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        BorrowBookLabel.setText("Borrow book");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.ipadx = 10;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(100, 40, 0, 40);
        add(BorrowBookLabel, gridBagConstraints);

        EnterBookIdLabel.setText("Enter Book Id");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.ipadx = 20;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(100, 100, 0, 0);
        add(EnterBookIdLabel, gridBagConstraints);

        EndDateLabel.setText("Enter End Date  (YYYY-MM-DD)");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.ipadx = 20;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(100, 100, 0, 0);
        add(EndDateLabel, gridBagConstraints);

        BackButton.setText("<<<");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.LAST_LINE_START;
        gridBagConstraints.insets = new java.awt.Insets(60, 60, 60, 60);
        add(BackButton, gridBagConstraints);
        BackButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                backButton(e);
            }
        });

        SendButton.setText("Send");
        SendButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
	            try {
		            SendButtonActionPerformed(evt);
	            } catch (SQLException e) {
		            throw new RuntimeException(e);
	            }
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.gridwidth = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.LAST_LINE_END;
        gridBagConstraints.insets = new java.awt.Insets(60, 60, 60, 60);
        add(SendButton, gridBagConstraints);
    }// </editor-fold>//GEN-END:initComponents

    private void formCaretPositionChanged(java.awt.event.InputMethodEvent evt) {//GEN-FIRST:event_formCaretPositionChanged
        // TODO add your handling code here:
    }//GEN-LAST:event_formCaretPositionChanged

    private void formComponentResized(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_formComponentResized
        // TODO add your handling code here:
    }//GEN-LAST:event_formComponentResized

    private void formAncestorResized(java.awt.event.HierarchyEvent evt) {//GEN-FIRST:event_formAncestorResized
        // TODO add your handling code here:
    }//GEN-LAST:event_formAncestorResized

    private void SendButtonActionPerformed(java.awt.event.ActionEvent evt) throws SQLException {//GEN-FIRST:event_SendButtonActionPerformed
        int book_id = Integer.parseInt(BookIdField.getText());
        String end_date = EndDateField.getText();

        ResultSet rs = Database.select_stmt("*", "User_GUI", "book_id=" + book_id);

        if (rs.next()) {
                Borrow borrow = new Borrow(NLogin.user_id,book_id,end_date);
               int result = borrow.insert();
               if (result > 0) {
                   JOptionPane.showMessageDialog(GUI.frame, "borrow is successfully");
                   User_gui.refresh(book_id);
               } else {
                   JOptionPane.showMessageDialog(GUI.frame,"borrow is Failed","Error", JOptionPane.WARNING_MESSAGE);
               }
        }else {
                JOptionPane.showMessageDialog(GUI.frame,"not found book has id: " + book_id
                    ,"Error", JOptionPane.WARNING_MESSAGE);
        }

    }//GEN-LAST:event_SendButtonActionPerformed
    private void backButton(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_SendButtonActionPerformed
        GUI.cardLayout.show(GUI.frame.getContentPane(), "userGui");
    }//GEN-LAST:event_SendButtonActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton BackButton;
    private javax.swing.JTextField BookIdField;
    private javax.swing.JLabel BorrowBookLabel;
    private javax.swing.JTextField EndDateField;
    private javax.swing.JLabel EndDateLabel;
    private javax.swing.JLabel EnterBookIdLabel;
    private javax.swing.JButton SendButton;
    // End of variables declaration//GEN-END:variables
}
